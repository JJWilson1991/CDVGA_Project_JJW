---
title: "NewMAP"
author: "Jonathan Wilson"
date: "23/01/2020"
output: html_document
---

```{r}


library(dplyr)

library(tidyverse)

library(forcats)

library(ggthemes)

library(plotly)

library(knitr)

library(naniar)

library(ggplot2)

library(maps)

library(ggmap)

library(maptools)

library(sf)

library(here)
```

```{r}
#now we'll get into the mapping, which is likely to be a major theme with this dataset
#we'll pull up our basic map iof US states first
statelines <- map_data("state")
ggplot(data = statelines) +  geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") + coord_fixed(1.3) + guides(fill=FALSE)
```
```{r}
#then we'll subset to out states in the ~SE that are represtned in our dataset
statelines <- map_data("state")
SE19<- subset(statelines, region %in% c("south carolina", "georgia",        "tennessee",      "virginia",       "west virginia", 
 "kentucky",       "north carolina", "florida",        "mississippi",    "kansas",        
 "maryland",       "louisiana",      "alabama",        "missouri",       "arkansas",      
"pennsylvania",   "nebraska" ))
ggplot(data = SE19) +  geom_polygon(aes(x = long, y = lat, fill = region, group = group), color = "white") + coord_fixed(1.3) + guides(fill=FALSE) 
```
```{r}

CDV_Clean19 <-   readRDS(here::here("data","processed_data","CDV19_clean.rds"))



glimpse(CDV_Clean19)

```
```{r}
#to be able to join our data sets with dplyr we need to capitalise the state names from the mapping data and change the ttle of the states vaiable to region so we can properly join our datasets
SEC19 <- dplyr :: rename(SE19, State = region)
capFirst <- function(s) {paste(toupper(substring(s, 1, 1)), substring(s, 2), sep = "")}

SEC19$State <- capFirst(SEC19$State)

StFr19 <- with(CDV_Clean19, table(State))
STFR19 <- as.data.frame(StFr19) 
SECC19 <- SEC19 %>% mutate(State = recode(State, "North carolina" = "North Carolina", "South carolina" = "South Carolina", "West virginia"= "West Virginia"))


dftr19 <- left_join(SECC19, STFR19)

library(viridis)


library(rgeos)

#we also want some state abbreviations we can put in the centre of our states on the map so we shall pull that data together
statescent <- data.frame(state.center, state.abb)
SECEnt <- subset(statescent, state.abb %in% c("PA","GA", "KS", "SC", "AR", "FL", "KY", "LA", "MD", "MS", "NC", "TN", "VA", "WV", "AL", "MO", "NE"))
```
```{r}
#we also want some major cites that we can plot on our final map
us <- map_data("state")
uscitiesdf <- as.data.frame(us.cities)
Bigcities <- uscitiesdf %>% filter(pop >2000000)
```
```{r}
library(ggrepel)
#now we'll pull all these layers togetehr in ggplot
SEC1 <- ggplot(data = dftr19) + 
  geom_polygon(data = us, aes(x = long, y = lat, group = group), color ="gray50", fill = "white") + 
  geom_polygon(aes(x = long, y = lat, fill = Freq, group = group), color = "gray50") + 
  coord_fixed(1.3) + 
  scale_fill_gradient(low = "seashell1", high = "dodgerblue4", na.value = "white", trans = "log10") 

SEC2 <- SEC1 + theme( 
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank(), legend.position = "right")

SEC3 <- SEC2 +  
  geom_text(data = SECEnt, aes(x = x, y = y, label = state.abb, group = NULL, size = )) + labs(fill= "Number of cases")

SEC4 <- SEC3
#+   geom_point(data = Bigcities, aes(x = long, y = lat), alpha = 0.5) +
  #geom_label_repel(data = Bigcities, aes(x = long, y = lat, label = name, group = NULL))

SEC4

ggsave(here::here("results", "Figures_new", "Cases_per_State19.png"),plot = SEC4)

statetable<- table(CDV_Clean19$State)
statetable<-as.data.frame(statetable)
statetable
  colnames(statetable)[1] <- "State"
  colnames(statetable)[2] <- "No. of cases"
  
statetable %>% saveRDS(here::here("results", "Tables", "statetable19.rds"))
#we also needed to recode the carolinas to capiatlise both words so we could properly join 
#i used a log scale here as GA is massively overrrepresented and it made it difficult to percive what other states are involved
```
```{r}
#now lets look at the state maps per year using facet wrap
StperYr19 <- with(CDV_Clean19, table(State, CollectionYear))
SPYdf19 <- as.data.frame(StperYr19)
spyrsttt19 <- left_join(SECC19, SPYdf19)
SECt119 <- ggplot(data = spyrsttt19) + geom_polygon(data = us, aes(x = long, y = lat, group = group), color ="gray50", fill = "gray70") + geom_polygon(aes(x = long, y = lat, fill = Freq, group = group), color = "gray50") + coord_fixed(1.3) +  scale_fill_gradient(low = "white", high = "slateblue4", na.value = "white", trans = "log10") 

SECt219 <- SECt119 + theme( 
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank(), legend.position = "right")

SECt319 <- SECt219 + labs(fill= "Number of cases")


SECT419 <- SECt319 + facet_wrap(~ CollectionYear)

SECT419

ggsave(here::here("results", "Figures_new", "Cases_per_State_WrapYear19.png"),plot = SECT419)

```






```{r}
library(sf)
SE_sf <- st_as_sf(map("county", regions = c("south carolina", "georgia",        "tennessee",      "virginia",       "west virginia", 
 "kentucky",       "north carolina", "florida",        "mississippi",    "kansas",        
 "maryland",       "louisiana",      "alabama",        "missouri",       "arkansas",      
"pennsylvania",   "nebraska"), plot = FALSE, fill = TRUE))


tt<-SE_sf%>% mutate(ID2=ID)

sepSE_sf<- tt %>% separate(ID, c("State", "County"), ",")


sepSE_sf$County<- capFirst(sepSE_sf$County)

sepSE_sf$State<- capFirst(sepSE_sf$State)
sepSE_sf<-sepSE_sf%>% mutate(State = recode(State, "North carolina" = "North Carolina", "South carolina" = "South Carolina", "West virginia"= "West Virginia"))%>% mutate(County=recode(County, "De kalb"="DeKalb", "Jeff davis"="Jeff Davis","Ben hill"= "Ben Hill", "Mcintosh"="McIntosh", "Mcduffie"="McDuffie"))
 
#calculate the centroids for each county

SE_centroid <- st_centroid(sepSE_sf)




SEtest4 <-  SE_centroid%>% mutate(tosplit= as.character(geometry))

SEtest4$tosplit <- sub(SEtest4$tosplit, pattern = "c", replacement = "")

SEtest4$tosplit <- sub(SEtest4$tosplit, pattern = "[(]", replacement = "")

SEtest4$tosplit <- sub(SEtest4$tosplit, pattern = "[)]", replacement = "")

SEtest4$tosplit<- sub(SEtest4$tosplit, pattern = "[,]", replacement = "")

SEtest5 <- SEtest4 %>% separate(tosplit, c("long", "lat"), " ")

SE_centroid_split<- SEtest5 %>% mutate(lat = as.numeric(as.character(lat))) %>% mutate(long = as.numeric(as.character(long)))

colnames(SE_centroid_split)[6]<- "Centroid"

SE_centroid_split %>% saveRDS(here::here("data", "processed_data", "SE_centroid.rds"))

plot(sepSE_sf["State"])
```

```{r}
testing123<-left_join(CDV_Clean19, sepSE_sf, by=c("County", "State"))

ttt<- as.data.frame(with(testing123,table(ID2)))

SE_freq_19<-left_join(sepSE_sf, ttt, by="ID2")


SE_centroid_split<-as_data_frame(SE_centroid_split)

cent_SE_19<-left_join(sepSE_sf, SE_centroid_split)

cent_spec_19<- left_join(cent_SE_19,CDV_Clean19 )

SESpec<- ggplot(cent_spec_19) + geom_sf(aes(geometry=geometry)) +  geom_point(data = cent_spec_19, aes(x = long, y = lat, color= Species), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T) + scale_colour_discrete( na.translate=F )
SESpec


ggsave(here::here("results", "Figures_new", "SE_AllSpec.png"),plot = SESpec)
```
```{r}
cent_spec_19_na_rm<- left_join(CDV_Clean19, cent_SE_19 )

SEYear<- ggplot(cent_spec_19) + geom_sf(aes(geometry=geometry), fill="grey90") +  geom_point(data = cent_spec_19_na_rm, aes(x = long, y = lat, color= CollectionYear),  alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T) +scale_color_continuous()
SEYear

ggsave(here::here("results", "Figures_new", "SE_Allyear.png"),plot = SESpec)

```



```{r}
#now filter for GA and racs and GF

fil_spec_19<-subset(cent_spec_19, State%in% "Georgia" &Species%in% c("Raccoon", "Gray Fox"))
RGFfil_spec_19a<-as_data_frame(subset(fil_spec_19, Species%in% c("Raccoon", "Gray Fox")))

CDV19_fi<-  subset(CDV_Clean19, Species %in% c("Raccoon", "Gray Fox") & State%in%"Georgia")

#remove NA county

CDV19_fi<-CDV19_fi[-292,]

#redo everything for plotting points

GApoint<-subset(cent_SE_19, State%in% "Georgia")
RGFfil_spec_19<- RGFfil_spec_19a[-c(14,15)]
pointRGF19<-left_join(GApoint,RGFfil_spec_19)

pointRGF19 %>% saveRDS(here::here("data","processed_data","RGF_lat_long.rds"))

GAspec<- ggplot(pointRGF19) + geom_sf(aes(geometry=geometry)) +  geom_point(data = pointRGF19, aes(x = long, y = lat, color= Species), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T) + scale_colour_discrete( na.translate=F )
GAspec

ggsave(here::here("results", "Figures_new", "RGFGA19.png"),plot = GAspec)
```
```{r}
4444
#wrap species pounts by year
Georgia_coorod<-subset(cent_SE_19, State%in% "Georgia")

pointRGF19_wrap<-right_join(GApoint,RGFfil_spec_19) 

pointRGF19_wrap %>% saveRDS(here::here("data", "processed_data", "Case_GA_Centroids.rds"))

GAspecyear19<- ggplot() + geom_sf(data=Georgia_coorod, aes(geometry=geometry)) +  geom_point(data = pointRGF19_wrap, aes(x = long, y = lat, color= Species), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T) + scale_colour_discrete( na.translate=F ) +facet_wrap(~CollectionYear) + theme_map() + theme(legend.position="right")
GAspecyear19

ggsave(here::here("results", "Figures_new", "GAspecyear19.png"),plot = GAspecyear19)

```
```{r}
RGFGA_CY<- ggplot(pointRGF19) + geom_sf(aes(geometry=geometry)) +  geom_point(data = pointRGF19, aes(x = long, y = lat, color= CollectionYear), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T) +scale_color_continuous(na.value="grey90")

RGFGA_CY

ggsave(here::here("results", "Figures_new", "RGF_Years_19.png"),plot = RGFGA_CY)
```
```{r}
#replot using simplefeatures for each county
SF_County19 <- ggplot() + 
  geom_sf(data = SE_freq_19, aes(geometry=geometry, fill = Freq))  +scale_fill_gradient(high = "purple4", low = "thistle1", na.value="white", trans = "log10") +
  labs(fill= "Number of cases") #+facet_wrap(~State)
# #+ 
#   geom_point(data = GAcitiesspread, aes(x = long, y = lat, size = Population), alpha = 0.5) + 
#   geom_text(data = GAcitiesspread, aes(x = long, y = lat, label = name, group = NULL), position = position_jitter(width=0.3,height=0.3)) 

SF_County19

ggsave(here::here("results", "Figures_new", "All_County_SF19.png"),plot = SF_County19)

#alterntive way of plotting mapping data
```


```{r}


#like we did earlier for our national map, lets get some data for the larger cities in georgia as reference points
colnames(uscitiesdf)[3] <- "Population"
GAcitiesspread <- uscitiesdf %>% subset(country.etc %in% "GA") %>% filter(Population>100000)
GA_county_19 <- subset(SE_freq_19, State %in% "Georgia") %>% as.data.frame()


GA_County19SF <- ggplot() + 
  geom_sf(data = GA_county_19, aes(geometry=geometry, fill = Freq))  +scale_fill_gradient(high = "purple4", low = "thistle1", na.value="white", trans = "log10") +
  labs(fill= "Number of cases") +   geom_point(data = GAcitiesspread, aes(x = long, y = lat, size = Population), alpha = 0.5) +    geom_text(data = GAcitiesspread, aes(x = long, y = lat, label = name, group = NULL), position = position_jitter(width=0.3,height=0.3)) 

GA_County19SF

ggsave(here::here("results", "Figures_new", "GA_County_SF19.png"),plot = GA_County19SF)

```

```{r}
#lets do presence map

sdf<- SE_freq_19 %>% mutate(Presence=Freq) 
sdf$Presence <- ifelse(sdf$Presence >0 ,TRUE, FALSE) 


sdf <- sdf %>% mutate(Presence = ifelse(is.na(Presence), FALSE, Presence))


presenceSF_County19 <- ggplot() + 
  geom_sf(data = sdf, aes(geometry=geometry, fill = Presence))  +
  labs(fill= "Presence") +  scale_fill_manual(values = c('white', 'turquoise4')) 

presenceSF_County19

ggsave(here::here("results", "Figures_new", "presenceSF_County19.png"),plot = presenceSF_County19)


```
```{r}
GA_presence_19 <- subset(sdf, State %in% "Georgia") %>% as.data.frame()


GApresenceSF_County19 <- ggplot() + 
  geom_sf(data = GA_presence_19, aes(geometry=geometry, fill = Presence))  +
  labs(fill= "Presence") +  scale_fill_manual(values = c('white', 'turquoise4'))  +   geom_point(data = GAcitiesspread, aes(x = long, y = lat, size = Population), alpha = 0.5) +    geom_text(data = GAcitiesspread, aes(x = long, y = lat, label = name, group = NULL), position = position_jitter(width=0.3,height=0.3)) 

GApresenceSF_County19


ggsave(here::here("results", "Figures_new", "GApresenceSF_County19.png"),plot = GApresenceSF_County19)

```


```{r}
CDV_Clean19
CDV19_fi<-  subset(CDV_Clean19, Species %in% c("Raccoon", "Gray Fox") & State=="Georgia")
County_year<- as.data.frame(table(CDV19_fi$County, CDV19_fi$CollectionYear))
colnames(County_year)[1] <- "County"
colnames(County_year)[2] <- "Year"





GA_County_year<-right_join(Georgia_coorod, County_year)

GCY1<- GA_County_year%>% mutate(Presence=Freq) 
GCY1$Presence <- ifelse(GCY1$Presence >0 ,TRUE, FALSE) 
 GCY2<- GCY1 %>% mutate(Presence = ifelse(is.na(Presence), FALSE, Presence))
 
GA_Presence_year19<-  ggplot() + 
geom_sf(data=Georgia_coorod, aes(geometry=geometry), fill="white")+  geom_sf(data = GCY2, aes(geometry=geometry, fill =Presence))  +
  labs(fill= "Presence") +  scale_fill_manual(values = c('white', 'turquoise4')) + theme_map() + facet_wrap(~Year,  drop =  T) + theme(legend.position="right")


GA_Presence_year19

ggsave(here::here("results", "Figures_new", "GA_Presence_year19.png"),plot = GA_Presence_year19)

```





```{r}


GA_cases_year19<-  ggplot() + 
geom_sf(data=Georgia_coorod, aes(geometry=geometry), fill="white")+  geom_sf(data = GA_County_year, aes(geometry=geometry, fill =Freq)) +
  labs(fill= "Cases per year") +  scale_fill_gradient(high = "purple", low="white", na.value="white", trans = "log10") + theme_map() + facet_wrap(~Year) + theme(legend.position="right")

GA_cases_year19

ggsave(here::here("results", "Figures_new", "County_Wrap_casesYear19.png"),plot = GA_cases_year19)



```



```{r}
County_Species<- as.data.frame(table(CDV19_fi$County, CDV19_fi$Species))
colnames(County_Species)[1]<-"County"
colnames(County_Species)[2]<-"Species"
County_species_map<-right_join(Georgia_coorod, County_Species)
  
GA_cases_Species19<-  ggplot() + 
geom_sf(data=Georgia_coorod, aes(geometry=geometry), fill="white")+  geom_sf(data = County_species_map, aes(geometry=geometry, fill =Freq)) +
  labs(fill= "Total cases 1975-2019") +  scale_fill_gradient(high = "purple", low="white", na.value="white", trans = "log10") + theme_map() + facet_wrap(~Species) + theme(legend.position="right") 

GA_cases_Species19


ggsave(here::here("results", "Figures_new", "GA_cases_Species19.png"),plot = GA_cases_Species19)
```

```{r}

County_year_split<- as.data.frame(table(CDV19_fi$County, CDV19_fi$Species, CDV19_fi$CollectionYear))
colnames(County_year_split)[1]<-"County"
colnames(County_year_split)[2]<-"Species"
colnames(County_year_split)[3]<-"Year"
County_year_split_map<-right_join(Georgia_coorod, County_year_split)
  
RMY <- subset(County_year_split_map, Species %in% "Raccoon")
GFMY<-subset(County_year_split_map, Species %in% "Gray Fox")
```

```{r}

GARac_cases_year19<-  ggplot() + 
geom_sf(data=Georgia_coorod, aes(geometry=geometry), fill="white")+  geom_sf(data = RMY, aes(geometry=geometry, fill =Freq)) +
  labs(fill= "Raccoon cases per year") +  scale_fill_gradient(high = "purple", low="white", na.value="white", trans = "log10") + theme_map() + facet_wrap(~Year) + theme(legend.position="right")

GARac_cases_year19

ggsave(here::here("results", "Figures_new", "GARac_cases_year19.png"),plot = GARac_cases_year19)

```
```{r}

GAGF_cases_year19<-  ggplot() + 
geom_sf(data=Georgia_coorod, aes(geometry=geometry), fill="white")+  geom_sf(data = GFMY, aes(geometry=geometry, fill =Freq)) +
  labs(fill= "Raccoon cases per year") +  scale_fill_gradient(high = "purple", low="white", na.value="white", trans = "log10") + theme_map() + facet_wrap(~Year) + theme(legend.position="right")

GAGF_cases_year19

ggsave(here::here("results", "Figures_new", "GAGF_cases_year19.png"),plot = GAGF_cases_year19)

```




```{r}

Cases_co_ord<-left_join(CDV19_fi, Georgia_coorod)


```
```{r}
#plot cases with stat density to try to show higher risk areas
Case_density19<- GAspec+ stat_density2d(data=Cases_co_ord, aes(x=long, y=lat, fill=..level.., alpha=..level..), 
                 size=2, bins=5, geom='polygon')+
  geom_point(data = centrLL, aes(x = long, y = lat, color= Species), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ) ) 

Case_density19
 
 ggsave(here::here("results", "Figures_new", "Case_density19.png"), plot = Case_density19)
```


#do i need this elsewhere?

<!-- #returning to the north-south issue, as georgia has distinct geographical areas, mountain north, piedmont plateau and then coastal plain in the south, lets divide are data using twiggs county as the state centre -->
<!-- GA_centroid[grep("Twiggs", GA_centroid$County), ] -->

<!-- NorthGA <- centrLL %>% filter(lat>=32.67328) -->
<!-- SouthGA <- centrLL %>% filter(lat<32.67328) -->
7520
```{r}
#pull census data to use population density for mapping
Raw_pop_GA <- read_csv(here::here("data", "raw_data", "2013_GAcensus_data.csv"))

glimpse(Raw_pop_GA)

Raw_GApop_col <- Raw_pop_GA[c(2,3)]

Raw_GApop_Col2 <- Raw_GApop_col[-c(1),] 

Raw_GApop_Col2$`GEO.display-label` <- sub(Raw_GApop_Col2$`GEO.display-label`, pattern = " County, Georgia", replacement = "")

GA_popcensus <- dplyr :: rename(Raw_GApop_Col2,County = `GEO.display-label`) 
GA_censuspop_2013 <- dplyr::rename(GA_popcensus, Population = respop72013)

#population per cpunty

Raw_census_GA <- read_csv(here::here("data", "raw_data", "GA_County_Area.csv"))

glimpse(Raw_census_GA)

Raw_census_area_col <- Raw_census_GA[c(3,8)]

Raw_census_area_Col2 <- Raw_census_area_col[-c(0,2,3),] 
GA_census_area1 <- dplyr :: rename(Raw_census_area_Col2,County = `GCT_STUB.display-label_1`) 
GA_census_area2 <- dplyr::rename(GA_census_area1, Land_Area_sqm = SUBHD0303)

GA_census_area2 <- GA_census_area2[-1,]
GA_census_area2$County <- sub(GA_census_area2$County, pattern = " County", replacement = "")

GA_Pop_Area_2013<-left_join(GA_census_area2, GA_censuspop_2013)

#join to cases data

GA_Pop_Den<-GA_Pop_Area_2013 %>%    mutate(Population= as.numeric(as.character(Population)))  %>% mutate(Land_Area_sqm= as.numeric(as.character(Land_Area_sqm))) %>% mutate(Pop_Density = (Population/Land_Area_sqm))

Cases_humanpop<- left_join(pointRGF19, GA_Pop_Den, by="County") 
```

```{r}

pop_points1 <- ggplot() + geom_sf(data= Cases_humanpop, aes(geometry=geometry, fill=Population)) +  geom_point(data = Cases_humanpop, aes(x = long, y = lat, color= Species), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T)

pop_points2<-pop_points1+ scale_colour_discrete( na.translate=F )  + labs(fill= "Human population per county") + scale_fill_gradient(low = "white", high = "purple") + theme_map() + theme(legend.position="right")

pop_points2

ggsave(here::here("results", "Figures_new", "Pop_cases_19.png"), plot = pop_points2)
#as atlanta is so densly populated its probably best to use a log scale


```
```{r}
log_pop_points2<-pop_points1 +  scale_colour_discrete( na.translate=F )  + labs(fill= "log10 human population per county") + scale_fill_gradient(low = "white", high = "purple", trans= "log10") + theme_map() + theme(legend.position="right")

log_pop_points2


ggsave(here::here("results", "Figures_new", "logPop_cases19.png"), plot = log_pop_points2)

```

```{r}
#a log scale looks better, should replot with county population density instead

#pull the population density data

```

```{r}
#repaeated with pop desnity

density_points1 <- ggplot() + geom_sf(data= Cases_humanpop, aes(geometry=geometry, fill=Pop_Density)) +  geom_point(data = Cases_humanpop, aes(x = long, y = lat, color= Species), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T)

density_points2<-density_points1+ scale_colour_discrete( na.translate=F )  + labs(fill= "Human population per county") + scale_fill_gradient(low = "white", high = "purple") + theme_map() + theme(legend.position="right")

density_points2

ggsave(here::here("results", "Figures_new", "Pop_Density_cases19.png"), plot = density_points2)

```
```{r}
#logdesnity

logdensity_points1 <- ggplot() + geom_sf(data= Cases_humanpop, aes(geometry=geometry, fill=Pop_Density)) +  geom_point(data = Cases_humanpop, aes(x = long, y = lat, color= Species), alpha = 0.5, position = position_jitter(width=0.05,height=0.05 ), na.rm = T)

logdensity_points2<-density_points1+ scale_colour_discrete( na.translate=F )  + labs(fill= "log10 population density per county") + scale_fill_gradient(low = "beige", high = "chocolate4", trans= "log10") + theme_map() + theme(legend.position="right")

logdensity_points2

ggsave(here::here("results", "Figures_new", "logPop_Density_cases19.png"), plot = logdensity_points2)
```

####75202



```{r}
#lets plot a graph of cases against population density of each county

Countyfreq<-left_join(GA_county_19, GA_Pop_Den, by="County")
  
Countyfreq[is.na(Countyfreq)] <- 0



Density_casesfreq<-ggplot(Countyfreq, aes(Pop_Density, Freq)) + geom_point()

Density_casesfreq

#converted na to zeros, end up with very large number of zeros, might be best to leave these as NA so they aren't included
#lots of counties have no cases
```
```{r}
#repeated with leaving out the counties with no cases, removing them doesnt really affect our graph very much

Countyfreq_NA<-left_join(GA_county_19, GA_Pop_Den, by="County")
  

Density_casesfreq_NA<-ggplot(Countyfreq_NA, aes(Pop_Density, Freq)) + geom_point()

Density_casesfreq_NA


```
```{r}
#lets correct the number of cases for the size of the county this time
Cases_per_area_PopD<-Countyfreq %>% dplyr::mutate(Cases_per_area= Freq/Land_Area_sqm)

ggplot(Cases_per_area_PopD, aes(Pop_Density, Cases_per_area)) + geom_point() 
#looks like there might be a relationship, between cases (corrected for county are) and population density

```
```{r}
#Repeat with NA instead
Cases_per_area_PopD_NA<-Countyfreq_NA %>% dplyr::mutate(Cases_per_area= Freq/Land_Area_sqm)

ggplot(Cases_per_area_PopD_NA, aes(Pop_Density, Cases_per_area)) + geom_point() 

#Removes big cluster of zeros
```
```{r}
#lets log the population density as atlanta is much more densely populated than anywhere else and is throwing everything off

Logpopdens_cases<- ggplot(Cases_per_area_PopD_NA , aes(log10(Pop_Density), Cases_per_area)) +geom_point() + geom_smooth()
Logpopdens_cases

#again an outlier is making it difficult to pic trends so lets log the cases per area too as it might be possible there is a hump shaped relationship

Logpop_logcases<-ggplot(Cases_per_area_PopD_NA, aes(log10(Pop_Density), log10(Cases_per_area))) + geom_point() +geom_smooth() + labs(x="log10(Population Density per sqm", y="log10(Cases per sqm)")

Logpop_logcases

ggsave(here::here("results", "Figures_new", "Logpop_logcases.png"), plot= Logpop_logcases)
```




```{r}
#Wrap by species
Species_density<-left_join(County_Species, GA_Pop_Den) %>% replace_with_na(replace = list(Freq = 0)) %>% dplyr::mutate(Cases_per_area= Freq/Land_Area_sqm)



Spec_Freq_pop<-ggplot(Species_density, aes(log10(Pop_Density), Freq, fill = Species, color = Species, group = Species)) + geom_point()  

Spec_Freq_pop

#Repeat with case per area
Spec_dens_pop<-ggplot(Species_density, aes(log10(Pop_Density), log10(Cases_per_area), fill = Species, color = Species, group = Species)) + geom_point()+geom_smooth() + labs(x="log10(Population Density per sqm", y="log10(Cases per sqm)")

Spec_dens_pop

#do a wrap

Spec_dens_pop_wrap<-Spec_dens_pop+ facet_wrap(~Species, ncol=1)

Spec_dens_pop_wrap

#no clear difference in Species distribution of cases per pop density



```

